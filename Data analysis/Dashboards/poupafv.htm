<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="text/html;charset=ISO-8859-1">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/series-label.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>

<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no"/>
<LINK REL="SHORTCUT ICON" HREF="./pics/energy-icon-vector-pv.png" type="image/x-icon">

<title>Poupança FotoVoltaico</title>

<head>
<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous">
</script> 

<style>
.highcharts-figure,
.highcharts-data-table table {
    /* min-width: 360px;
    max-width: 800px; */
    width:100%;
    height: 90%;
    margin: 1em auto;
}

.highcharts-data-table table {
    font-family: Verdana, sans-serif;
    border-collapse: collapse;
    border: 1px solid #ebebeb;
    margin: 10px auto;
    text-align: center;
    width: 100%;
    max-width: 500px;
}

.highcharts-data-table caption {
    padding: 1em 0;
    font-size: 1.2em;
    color: #555;
}

.highcharts-data-table th {
    font-weight: 600;
    padding: 0.5em;
}

.highcharts-data-table td,
.highcharts-data-table th,
.highcharts-data-table caption {
    padding: 0.5em;
}

.highcharts-data-table thead tr,
.highcharts-data-table tr:nth-child(even) {
    background: #f8f8f8;
}

.highcharts-data-table tr:hover {
    background: #f1f7ff;
}


</style>

</head>
<body onload="lecpes()" style='font-family: montserrat'>

    <table width='100%' border=1 cellspacing="0" cellpadding="0" style="border:3px solid lime;border-radius:5px;font-family: montserrat;">
    <tr  style='font-weight: bold;color:whitesmoke;background-color: grey;opacity:.7;'> 
      <td style='width: 43%' align=center><input type="text" id="agora2" style='width:250px;text-align: center;' title='hora' readonly value="....">
      <td style='width: 12%' align=center cellpadding=5 cellspacing=3><font size=4>BaZe
        <td>
<table id=tal width='100%'><tr><td>
<td style='width:100%;' id=metalarm_old></table>
</table>

<table border=1 cellspacing="0" width='100%'>
	<tr>
		<td width=110 align=center rowspan=3>
            <!--
                <table><tr><td>15min<td><input type=radio name=peri value=def id=default onchange=leconsu()>
                    <tr><td>hora<td><input type=radio name=peri value=hora id=hora  onchange=leconsu()>
                    <tr><td>dia<td><input type=radio name=peri value=dia id=dia  checked  onchange=leconsu()>
                    <tr><td>mês<td><input type=radio name=peri value=mes id=mes  onchange=leconsu()>
                </table>
                --><hr>
                <texarea style="font-size: 11px;" id=perf></texarea>
         <!--
		<td width=110>
       <select id='listaCPE' style='border:0px;' onchange='leconsu(this[this.selectedIndex].value)'> -->
            <!--
        <select id='listaCPE' style='border:0px;' onchange='leconsu()'> -->
		<td><center>  
                    <div id=chart1 width='100%'  style='width:100%;border:1px dotted lime;min-height: 20%;min-width:500px;height: 275px;' valign=middle><br><br><br><br>
                <img src='./pics/Spinner-1s-131px.gif'>
            <br>[Loading...]<br></div>

                    <div id=chart2 width='100%'  style='width:100%;border:1px dotted lime;min-height: 20%;min-width:500px;height: 275px;' valign=middle><br><br><br><br>
                <img src='./pics/Spinner-1s-131px.gif'>
            <br>[Loading...]<br></div>

            <td style="valign=middle">

    <div id=chart4 width='100%'  style='width:100%;border:1px dotted lime;min-height: 20%;min-width:500px;height: 500px;' valign=middle><br><br><br><br>
                <img src='./pics/Spinner-1s-131px.gif'>
            <br>[Loading...]<br></div>



            <tr><td colspan=2>
                    <div id=chart3 width='100%'  style='width:100%;border:1px dotted lime;min-height: 20%;min-width:500px;height: 275px;' valign=middle><br><br><br><br>
                <img src='./pics/Spinner-1s-131px.gif'>
            <br>[Loading...]<br></div>
            <div id=leg3 style='text-align: left;'>
                Para o traçado deste gráfico, aplicou-se a seguinte transformação (arbitrária) ao valor da Radiação:
                        $$Radiação^* = 120-.18 \times Radiação$$  

    Informação complementar em:<ol> 
     <li>Consumo <a href='http://baze.cm-maia.pt/BaZe/consumoe.htm?cpe=PT0002000079469719HF' target=new title='CPE PT0002000079469719HF'>CPE PT0002000079469719HF</a>.
     <li>Radiação solar (e outras variáveis) medidas na <a href='http://baze.cm-maia.pt/BaZe/cverde3.htm' target=new title='Mais info'>Cobertura Verde</a>.   
     <li><a href='http://baze.cm-maia.pt/BaZe/base2b.htm?e0=pro-baze-omega-x' target=new title='mapa'>mapa</a> com a localização da "Cobertura Verde" (<img src='./pics/green roof.png' width=20>) e das "Piscinas de Gueifães" (<img src='./pics/solpow.png' width=20>).
     </ol>

            </div>

            </center><div id=legenda></div>
            

</table>
<table border=0 cellpadding="0" cellspacing="2"><tr>
    <td><img src="./pics/LogoBaZe.png" width=22 title='BaZe'>
    <td><img src="./pics/LogoOmega-X.png" width=22  title='Omega-X'>
    <td>PCP, 2022
</table>
<script>

function plotchartdu(chart)
{
    Highcharts.setOptions({chart: {style: {fontFamily: 'Montserrat'}}});
    
    wa= Highcharts.chart(chart, {

    colors: colors,
    title: { text: title,
    useHTML:true },
    yAxis: { title: { text: ytitle} },

    xAxis: { type:'datetime' },

    tooltip: {
        xDateFormat: '%Y-%m-%d %H:%M:%S',
        shared: true
    },
    //legend: { layout: 'vertical',  align: 'right',   verticalAlign: 'middle' },
    plotOptions: {
        series: {
            label: {
                connectorAllowed: false
            } //,  pointStart: 2010
        }
    },
    series: series ,
    responsive: {
        rules: [{condition: { maxWidth: 500 },
            chartOptions: {legend: {
                    layout: 'horizontal',
                    align: 'center',
                    verticalAlign: 'bottom'
                }
            }
        }]
                } 

});

if (labelText!=false)
{
  wa.renderer.text(labelText, 80, 80)
      .attr({
        zIndex: 5
      })
      .css({
        fontSize: '12px'
      })
      .add();
}
}

colors = ['#C0C0C0', '#808080','#101010', 'black', '#050505', '#E80C7A'];

kb=0;
bts=0
s=[]    

$.ajaxSetup({
    async: false
})

function leconsu()
{   start=performance.now()	
    bts=0
    s=[]
    s2=[]
    s1=[]

    ag="hora"

    period=ag
    cpe="PT0002000079469719HF"
    ag="hora"
    url = "http://baze.cm-maia.pt/BaZe/api/cpeconsu.php?ag="+ag+"&cpe="+cpe+"&tstart=20220701&tend=20220707" 
   // console.log(url)
    legenda1=""

	$.getJSON(url, function(r){
        kb=r;
        bts+=JSON.stringify(r).length;
        console.log(r.cpe)
        for (i in r.t)
        {   td=r.t[i]
            // console.log("TD"+td)    
            while (td.length < 14) 
                {td+="0"; }
                dia =   td.substr(6,2)
            if (dia=="00") dia = "01"
            //console.log("TD"+td)    
             td2=td.substr(0,4)+"-"+td.substr(4,2)+"-"+dia+" "+td.substr(8,2)+":"+td.substr(10,2)+":"+td.substr(12,2)
            datats = (new Date(td2)).getTime()+1000*60*60
            s[i]=[datats, r.v[i]]
        }
        legenda1=JSON.stringify(r.metadata)
    s1=JSON.parse(JSON.stringify(s))
	})


    url = "http://baze.cm-maia.pt/BaZe/api/cverde3.php?tstart=2022-07-01%2000:00:00&tend=2022-07-07%2000:00:00" 

     //   url= encodeURLComponent("api/cverde3.php?tstart=2022-07-01 00:00:00&tend=2022-07-16 00:00:00")
    s=[]
    sb=[]
    console.log(url)
    legenda1=""

    $.getJSON(url, function(r){
        kb=r;
        bts+=JSON.stringify(r).length;

        for (i in r.features[0].properties.tser1)
        {   datats = (new Date(r.features[0].properties.tser1[i][0])).getTime()+1000*60*60
            s[i]=[datats, r.features[0].properties.tser1[i][6]] 
            sb[i]=[datats, 120-.18*r.features[0].properties.tser1[i][6]]
        }
        legenda2=JSON.stringify(r.metadata)
        s2=JSON.parse(JSON.stringify(s))

    })


    // Char da Energia Consumida
    labelText = false
    ytitle="Consumo (kWh)"
    title="<p align='center'><a href='http://baze.cm-maia.pt/BaZe/consumoe.htm?cpe=PT0002000079469719HF' target=new title='Consumo CPE' >CPE PT0002000079469719HF</a><br>(Piscinas de Gueifães)</p>"
    series=[{name:"Consumo CPE PT0002000079469719HF", data:s1, marker:{enabled:true}}]
    document.getElementById("legenda").innerHTML = legenda1;    
    plotchartdu("chart1") 

        colors = ['gold', '#808080','#101010', 'black', '#050505', '#E80C7A'];

    // Char da Radiação recebida na Cobertura Verde
    title="Radiação (medida na <a href='http://baze.cm-maia.pt/BaZe/cverde3.htm' target=new title='Mais info'>Cobertura Verde</a> ~ <a href='http://baze.cm-maia.pt/BaZe/base2b.htm?e0=pro-baze-omega-x' target=new title='mapa'>3km noroeste das Piscinas</a>)"
    ytitle="Radiação (w/m2)"
    series=[{name:'Radiação @ Cobertura Verde ', data:s2, marker:{enabled:true}}]
    document.getElementById("legenda").innerHTML = legenda1;    
    plotchartdu("chart2") 

    // Sobreposição Energia Consumida / Radiação recebida
    colors = ['#C0C0C0', 'gold','#101010', 'black', '#050505', '#E80C7A'];

    title = "Sobreposição do 'vale de consumo' com o 'pico de radiação'"
   series=[{name:'Consumo', data:s1, marker:{enabled:true}},  {name:'Radiação*', data:sb, marker:{enabled:true}}]
//  series=[{name:'Consumo', data:s2, marker:{enabled:true}}]

    
    ytitle="Consumo e Radiação<sup>*</sup>"
    document.getElementById("legenda").innerHTML = legenda1;    
    plotchartdu("chart3") 
    
    duration = performance.now() - start;
    uf=[" msec", 1, 0]
    if (duration > 1000) uf=[" sec", 1000, 2]
    document.getElementById("perf").innerHTML=(bts/1024).toFixed(0) +"Kb de dados recebidos em " +  (duration/uf[1]).toFixed(uf[2])+uf[0]+"."
}



    s3=[]
    s3x=[]
    s3y=[]
    reg=[]

function lecpes()
{   console.log("lecpes")
    // ...
leconsu()  
/*
    s1=[[1656633600000,92],[1656637200000,128],[1656640800000,129],[1656644400000,128],[1656648000000,117],[1656651600000,116],[1656655200000,115],[1656658800000,132],[1656662400000,147],[1656666000000,136],[1656669600000,107],[1656673200000,86],[1656676800000,62],[1656680400000,55],[1656684000000,51],[1656687600000,54],[1656691200000,69],[1656694800000,97],[1656698400000,125],[1656702000000,146],[1656705600000,161],[1656709200000,177],[1656712800000,160],[1656716400000,148],[1656720000000,125],[1656723600000,128],[1656727200000,127],[1656730800000,128],[1656734400000,119],[1656738000000,119],[1656741600000,115],[1656745200000,130],[1656748800000,140],[1656752400000,144],[1656756000000,121],[1656759600000,121],[1656763200000,84],[1656766800000,69],[1656770400000,48],[1656774000000,57],[1656777600000,75],[1656781200000,101],[1656784800000,130],[1656788400000,148],[1656792000000,134],[1656795600000,132],[1656799200000,125],[1656802800000,124],[1656806400000,126],[1656810000000,128],[1656813600000,127],[1656817200000,128],[1656820800000,119],[1656824400000,117],[1656828000000,117],[1656831600000,115],[1656835200000,128],[1656838800000,150],[1656842400000,147],[1656846000000,128],[1656849600000,71],[1656853200000,58],[1656856800000,48],[1656860400000,58],[1656864000000,43],[1656867600000,68],[1656871200000,91],[1656874800000,116],[1656878400000,119],[1656882000000,122],[1656885600000,122],[1656889200000,127],[1656892800000,124],[1656896400000,128],[1656900000000,127],[1656903600000,127],[1656907200000,117],[1656910800000,117],[1656914400000,113],[1656918000000,124],[1656921600000,135],[1656925200000,141],[1656928800000,115],[1656932400000,88],[1656936000000,66],[1656939600000,72],[1656943200000,74],[1656946800000,81],[1656950400000,81],[1656954000000,119],[1656957600000,143],[1656961200000,159],[1656964800000,158],[1656968400000,171],[1656972000000,155],[1656975600000,144],[1656979200000,121],[1656982800000,127],[1656986400000,129],[1656990000000,128],[1656993600000,120],[1656997200000,116],[1657000800000,116],[1657004400000,129],[1657008000000,137],[1657011600000,129],[1657015200000,112],[1657018800000,85],[1657022400000,69],[1657026000000,55],[1657029600000,54],[1657033200000,55],[1657036800000,68],[1657040400000,91],[1657044000000,147],[1657047600000,158],[1657051200000,164],[1657054800000,170],[1657058400000,156],[1657062000000,139],[1657065600000,120],[1657069200000,125],[1657072800000,128],[1657076400000,127],[1657080000000,122],[1657083600000,117],[1657087200000,114],[1657090800000,129],[1657094400000,139],[1657098000000,129],[1657101600000,109],[1657105200000,88],[1657108800000,68],[1657112400000,51],[1657116000000,50],[1657119600000,55],[1657123200000,69],[1657126800000,102],[1657130400000,130],[1657134000000,150],[1657137600000,159],[1657141200000,170],[1657144800000,153],[1657148400000,144]]

    s2=[[1657151100000,0],[1657150200000,0],[1657149300000,0],[1657148400000,0],[1657147500000,0],[1657146600000,0],[1657145700000,0],[1657144800000,0],[1657143900000,0],[1657143000000,0],[1657142100000,4],[1657141200000,11],[1657140300000,31],[1657139400000,66],[1657138500000,97],[1657137600000,129],[1657136700000,164],[1657135800000,201],[1657134900000,252],[1657134000000,277],[1657133100000,314],[1657132200000,352],[1657131300000,389],[1657130400000,426],[1657129500000,463],[1657128600000,500],[1657127700000,533],[1657126800000,566],[1657125900000,596],[1657125000000,625],[1657124100000,653],[1657123200000,678],[1657122300000,700],[1657121400000,712],[1657120500000,703],[1657119600000,683],[1657118700000,645],[1657117800000,704],[1657116900000,759],[1657116000000,777],[1657115100000,773],[1657114200000,771],[1657113300000,766],[1657112400000,758],[1657111500000,747],[1657110600000,730],[1657109700000,716],[1657108800000,694],[1657107900000,671],[1657107000000,648],[1657106100000,619],[1657105200000,592],[1657104300000,559],[1657103400000,513],[1657102500000,496],[1657101600000,459],[1657100700000,422],[1657099800000,387],[1657098900000,350],[1657098000000,312],[1657097100000,253],[1657096200000,214],[1657095300000,201],[1657094400000,170],[1657093500000,138],[1657092600000,108],[1657091700000,79],[1657090800000,50],[1657089900000,31],[1657089000000,13],[1657088100000,3],[1657087200000,0],[1657086300000,0],[1657085400000,0],[1657084500000,0],[1657083600000,0],[1657082700000,0],[1657081800000,0],[1657080900000,0],[1657080000000,0],[1657079100000,0],[1657078200000,0],[1657077300000,0],[1657076400000,0],[1657075500000,0],[1657074600000,0],[1657073700000,0],[1657072800000,0],[1657071900000,0],[1657071000000,0],[1657070100000,0],[1657069200000,0],[1657068300000,0],[1657067400000,0],[1657066500000,0],[1657065600000,0],[1657064700000,0],[1657063800000,0],[1657062900000,0],[1657062000000,0],[1657061100000,0],[1657060200000,0],[1657059300000,0],[1657058400000,0],[1657057500000,0],[1657056600000,2],[1657055700000,25],[1657054800000,43],[1657053900000,85],[1657053000000,98],[1657052100000,123],[1657051200000,77],[1657050300000,101],[1657049400000,180],[1657048500000,278],[1657047600000,225],[1657046700000,215],[1657045800000,177],[1657044900000,188],[1657044000000,382],[1657043100000,614],[1657042200000,577],[1657041300000,561],[1657040400000,580],[1657039500000,611],[1657038600000,638],[1657037700000,666],[1657036800000,690],[1657035900000,710],[1657035000000,719],[1657034100000,711],[1657033200000,691],[1657032300000,651],[1657031400000,708],[1657030500000,764],[1657029600000,784],[1657028700000,782],[1657027800000,776],[1657026900000,771],[1657026000000,762],[1657025100000,751],[1657024200000,736],[1657023300000,716],[1657022400000,692],[1657021500000,668],[1657020600000,643],[1657019700000,612],[1657018800000,583],[1657017900000,553],[1657017000000,508],[1657016100000,487],[1657015200000,450],[1657014300000,414],[1657013400000,376],[1657012500000,341],[1657011600000,303],[1657010700000,246],[1657009800000,210],[1657008900000,194],[1657008000000,162],[1657007100000,134],[1657006200000,108],[1657005300000,80],[1657004400000,53],[1657003500000,32],[1657002600000,14],[1657001700000,4],[1657000800000,0],[1656999900000,0],[1656999000000,0],[1656998100000,0],[1656997200000,0],[1656996300000,0],[1656995400000,0],[1656994500000,0],[1656993600000,0],[1656992700000,0],[1656991800000,0],[1656990900000,0],[1656990000000,0],[1656989100000,0],[1656988200000,0],[1656987300000,0],[1656986400000,0],[1656985500000,0],[1656984600000,0],[1656983700000,0],[1656982800000,0],[1656981900000,0],[1656981000000,0],[1656980100000,0],[1656979200000,0],[1656978300000,0],[1656977400000,0],[1656976500000,0],[1656975600000,0],[1656974700000,0],[1656973800000,0],[1656972900000,0],[1656972000000,0],[1656971100000,0],[1656970200000,0],[1656969300000,4],[1656968400000,11],[1656967500000,20],[1656966600000,38],[1656965700000,70],[1656964800000,70],[1656963900000,98],[1656963000000,117],[1656962100000,111],[1656961200000,136],[1656960300000,155],[1656959400000,169],[1656958500000,163],[1656957600000,212],[1656956700000,462],[1656955800000,466],[1656954900000,290],[1656954000000,289],[1656953100000,615],[1656952200000,657],[1656951300000,679],[1656950400000,755],[1656949500000,685],[1656948600000,706],[1656947700000,562],[1656946800000,242],[1656945900000,246],[1656945000000,455],[1656944100000,524],[1656943200000,610],[1656942300000,612],[1656941400000,498],[1656940500000,644],[1656939600000,684],[1656938700000,709],[1656937800000,712],[1656936900000,665],[1656936000000,686],[1656935100000,660],[1656934200000,635],[1656933300000,573],[1656932400000,563],[1656931500000,542],[1656930600000,504],[1656929700000,469],[1656928800000,361],[1656927900000,279],[1656927000000,143],[1656926100000,122],[1656925200000,107],[1656924300000,91],[1656923400000,93],[1656922500000,55],[1656921600000,46],[1656920700000,49],[1656919800000,40],[1656918900000,36],[1656918000000,24],[1656917100000,8],[1656916200000,3],[1656915300000,1],[1656914400000,0],[1656913500000,0],[1656912600000,0],[1656911700000,0],[1656910800000,0],[1656909900000,0],[1656909000000,0],[1656908100000,0],[1656907200000,0],[1656906300000,0],[1656905400000,0],[1656904500000,0],[1656903600000,0],[1656902700000,0],[1656901800000,0],[1656900900000,0],[1656900000000,0],[1656899100000,0],[1656898200000,0],[1656897300000,0],[1656896400000,0],[1656895500000,0],[1656894600000,0],[1656893700000,0],[1656892800000,0],[1656891900000,0],[1656891000000,0],[1656890100000,0],[1656889200000,0],[1656888300000,0],[1656887400000,0],[1656886500000,0],[1656885600000,0],[1656884700000,0],[1656883800000,0],[1656882900000,3],[1656882000000,10],[1656881100000,13],[1656880200000,15],[1656879300000,22],[1656878400000,60],[1656877500000,97],[1656876600000,108],[1656875700000,114],[1656874800000,273],[1656873900000,336],[1656873000000,383],[1656872100000,412],[1656871200000,446],[1656870300000,481],[1656869400000,519],[1656868500000,561],[1656867600000,588],[1656866700000,632],[1656865800000,565],[1656864900000,611],[1656864000000,365],[1656863100000,440],[1656862200000,494],[1656861300000,510],[1656860400000,445],[1656859500000,474],[1656858600000,556],[1656857700000,721],[1656856800000,732],[1656855900000,634],[1656855000000,787],[1656854100000,749],[1656853200000,529],[1656852300000,678],[1656851400000,678],[1656850500000,611],[1656849600000,458],[1656848700000,285],[1656847800000,331],[1656846900000,339],[1656846000000,209],[1656845100000,111],[1656844200000,73],[1656843300000,38],[1656842400000,18],[1656841500000,16],[1656840600000,16],[1656839700000,76],[1656838800000,109],[1656837900000,100],[1656837000000,76],[1656836100000,53],[1656835200000,38],[1656834300000,12],[1656833400000,6],[1656832500000,3],[1656831600000,12],[1656830700000,13],[1656829800000,4],[1656828900000,1],[1656828000000,0],[1656827100000,0],[1656826200000,0],[1656825300000,0],[1656824400000,0],[1656823500000,0],[1656822600000,0],[1656821700000,0],[1656820800000,0],[1656819900000,0],[1656819000000,0],[1656818100000,0],[1656817200000,0],[1656816300000,0],[1656815400000,0],[1656814500000,0],[1656813600000,0],[1656812700000,0],[1656811800000,0],[1656810900000,0],[1656810000000,0],[1656809100000,0],[1656808200000,0],[1656807300000,0],[1656806400000,0],[1656805500000,0],[1656804600000,0],[1656803700000,0],[1656802800000,0],[1656801900000,0],[1656801000000,0],[1656800100000,0],[1656799200000,0],[1656798300000,0],[1656797400000,0],[1656796500000,4],[1656795600000,11],[1656794700000,33],[1656793800000,65],[1656792900000,97],[1656792000000,131],[1656791100000,166],[1656790200000,202],[1656789300000,255],[1656788400000,285],[1656787500000,321],[1656786600000,361],[1656785700000,399],[1656784800000,437],[1656783900000,474],[1656783000000,511],[1656782100000,547],[1656781200000,581],[1656780300000,615],[1656779400000,645],[1656778500000,675],[1656777600000,702],[1656776700000,726],[1656775800000,741],[1656774900000,730],[1656774000000,709],[1656773100000,666],[1656772200000,727],[1656771300000,797],[1656770400000,828],[1656769500000,739],[1656768600000,839],[1656767700000,615],[1656766800000,680],[1656765900000,562],[1656765000000,429],[1656764100000,702],[1656763200000,811],[1656762300000,523],[1656761400000,355],[1656760500000,375],[1656759600000,369],[1656758700000,463],[1656757800000,497],[1656756900000,545],[1656756000000,489],[1656755100000,448],[1656754200000,404],[1656753300000,365],[1656752400000,207],[1656751500000,117],[1656750600000,170],[1656749700000,236],[1656748800000,170],[1656747900000,180],[1656747000000,140],[1656746100000,99],[1656745200000,44],[1656744300000,41],[1656743400000,20],[1656742500000,5],[1656741600000,1],[1656740700000,0],[1656739800000,0],[1656738900000,0],[1656738000000,0],[1656737100000,0],[1656736200000,0],[1656735300000,0],[1656734400000,0],[1656733500000,0],[1656732600000,0],[1656731700000,0],[1656730800000,0],[1656729900000,0],[1656729000000,0],[1656728100000,0],[1656727200000,0],[1656726300000,0],[1656725400000,0],[1656724500000,0],[1656723600000,0],[1656722700000,0],[1656721800000,0],[1656720900000,0],[1656720000000,0],[1656719100000,0],[1656718200000,0],[1656717300000,0],[1656716400000,0],[1656715500000,0],[1656714600000,0],[1656713700000,0],[1656712800000,0],[1656711900000,0],[1656711000000,0],[1656710100000,4],[1656709200000,9],[1656708300000,43],[1656707400000,81],[1656706500000,112],[1656705600000,146],[1656704700000,181],[1656703800000,218],[1656702900000,274],[1656702000000,301],[1656701100000,335],[1656700200000,374],[1656699300000,413],[1656698400000,451],[1656697500000,489],[1656696600000,525],[1656695700000,560],[1656694800000,593],[1656693900000,624],[1656693000000,655],[1656692100000,682],[1656691200000,708],[1656690300000,731],[1656689400000,746],[1656688500000,735],[1656687600000,714],[1656686700000,668],[1656685800000,721],[1656684900000,788],[1656684000000,813],[1656683100000,812],[1656682200000,809],[1656681300000,801],[1656680400000,790],[1656679500000,777],[1656678600000,760],[1656677700000,743],[1656676800000,721],[1656675900000,696],[1656675000000,672],[1656674100000,643],[1656673200000,617],[1656672300000,584],[1656671400000,542],[1656670500000,517],[1656669600000,479],[1656668700000,442],[1656667800000,406],[1656666900000,368],[1656666000000,327],[1656665100000,265],[1656664200000,229],[1656663300000,215],[1656662400000,184],[1656661500000,151],[1656660600000,120],[1656659700000,89],[1656658800000,59],[1656657900000,41],[1656657000000,23],[1656656100000,5],[1656655200000,1],[1656654300000,0],[1656653400000,0],[1656652500000,0],[1656651600000,0],[1656650700000,0],[1656649800000,0],[1656648900000,0],[1656648000000,0],[1656647100000,0],[1656646200000,0],[1656645300000,0],[1656644400000,0],[1656643500000,0],[1656642600000,0],[1656641700000,0],[1656640800000,0],[1656639900000,0],[1656639000000,0],[1656638100000,0],[1656637200000,0],[1656636300000,0],[1656635400000,0],[1656634500000,0]]
*/
    console.log("mmmm")
    for (i=1; i< s1.length-1; i++)
    {   linf=(s1[i-1][0]+s1[i][0])/2;
        lsup=(s1[i][0]+s1[i+1][0])/2
        console.log("linf, lsup", linf, lsup)
        kn=0
        topp=0
        for (j in s2)
        {   
            if (s2[j][0]<lsup && s2[j][0]>linf)
            {       topp+=s2[j][1]*1
                    console.log("««««««««««««««««««")
                    kn++
            }
        }

        if ((topp/kn) > 5) {s3.push([topp/kn, 150-s1[i][1]]) 
            s3x.push(topp/kn)
            s3y.push(150-s1[i][1])
        }
        
    }

    s3.sort(function(a,b) {
        return a[0]-b[0]
    });


    ytitle="Poupança (C_ref - Consumo) (kWh)"
    xtitle="Radiação"
    title="<p align='center'>(Consumo_ref - Consumo) vs Radiação</p>"
    series=[{name:"(C_ref - Consumo) vs Radiação", data:s3, marker:{enabled:true, radius:3}, lineWidth:0}]
    //document.getElementById("legenda").innerHTML = "legenda1";    

    reg=linearRegression(s3y, s3x)


    s4=[[0, 0], [800, 0]]
    s4[0][1]=reg.intercept + reg.slope*s4[0][0];
    s4[1][1]=reg.intercept + reg.slope*s4[1][0];

    series=[{name:"Poupança vs Radiação", data:s3, marker:{enabled:true, radius:3}, lineWidth:0,     dashStyle: 'longdash'
},
    {name:"Regressão (C_ref - Consumo) vs Radiação", data:s4, marker:{enabled:false, radius:3}, lineWidth:2,     dashStyle: 'longdash'
}
    ]

    colors = ['#C0C0C0', 'lime','#101010', 'black', '#050505', '#E80C7A'];

    labelText = "Coef. regressão " + reg.r2.toFixed(4)

    plotchartdu2("chart4") 

}


function linearRegression(y,x){
        var lr = {};
        var n = y.length;
        var sum_x = 0;
        var sum_y = 0;
        var sum_xy = 0;
        var sum_xx = 0;
        var sum_yy = 0;

        for (var i = 0; i < y.length; i++) {

            sum_x += x[i];
            sum_y += y[i];
            sum_xy += (x[i]*y[i]);
            sum_xx += (x[i]*x[i]);
            sum_yy += (y[i]*y[i]);
        } 

        lr['slope'] = (n * sum_xy - sum_x * sum_y) / (n*sum_xx - sum_x * sum_x);
        lr['intercept'] = (sum_y - lr.slope * sum_x)/n;
        lr['r2'] = Math.pow((n*sum_xy - sum_x*sum_y)/Math.sqrt((n*sum_xx-sum_x*sum_x)*(n*sum_yy-sum_y*sum_y)),2);

        return lr;
}

function plotchartdu2(chart)
{
    Highcharts.setOptions({chart: {style: {fontFamily: 'Montserrat'}}});
    
    wa= Highcharts.chart(chart, {

    colors: colors,
    title: { text: title,
    useHTML:true },
    yAxis: { title: { text: ytitle} },

//    xAxis: { type:'datetime' },

    tooltip: {
        xDateFormat: '%Y-%m-%d %H:%M:%S',
        shared: true
    },
    //legend: { layout: 'vertical',  align: 'right',   verticalAlign: 'middle' },
    plotOptions: {
        series: {
            label: {
                connectorAllowed: false
            } 
        }
    },
    series: series ,
    responsive: {
        rules: [{condition: { maxWidth: 500 },
            chartOptions: {legend: {
                    layout: 'horizontal',
                    align: 'center',
                    verticalAlign: 'bottom'
                }
            }
        }]
 }});

if (labelText!=false)
{
  wa.renderer.text(labelText, 80, 80)
      .attr({
        zIndex: 5
      })
      .css({
        fontSize: '12px'
      })
      .add();
}
}

var agorah;
function set0()
{ //  console.log("set0"+Date()) 
 //    W=new Date().toString().substring(0,24)
 //   document.getElementById('agora2').value= W;
   document.getElementById('agora2').value= Date().toString().substring(0,24);
   agorah=setTimeout(function(){ set0(); },5000)
 //   console.log("agorah:"+agorah)
}
set0()
</script>


</body>
</html>